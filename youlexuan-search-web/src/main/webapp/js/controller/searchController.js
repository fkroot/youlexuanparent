app.controller('searchController',function($scope,searchService,$location){
    //搜索
    $scope.search=function(){
                    $scope.searchMap.pageNo = parseInt($scope.searchMap.pageNo);
        searchService.search($scope.searchMap).success(
            function(response){
            /*    console.log($scope.searchMap)*/
                console.log(response)
               /* console.log(response.specList.options);*/
                $scope.resultMap = response;//搜索返回的结果
               buildPage()

            }
        );
    }
    //定义搜索对象
    //加入分页条件
    $scope.searchMap = {'keywords':"",'category':"",'brand ':"",'spec':{},'price':"",'pageNo':1,'pageSize':10,'sortField':'',sort:''};

    $scope.addSearchItem = function (key,value) {

        if(key=="brand" || key=="category"||key=="price"){
            $scope.searchMap[key] = value;

        }else{
            $scope.searchMap.spec[key] = value;
        }
        $scope.search()
        
    }
    $scope.deleSearchItem = function (key) {
        console.log(key)


if(key == 'brand' || key == "category"||key=="price"){
   $scope.searchMap[key] == '';
}else{
    delete $scope.searchMap.spec[key];


}
        $scope.search()
    }
    //自己定义一个分页方法
    $scope.buildPage = function () {
$scope.pageLable = [];
var maxPageNum = resultMap.totalPages;
var firstPage = 1;
var lastPage = maxPageNum;
$scope.firstDot = true;
$scope.lastDot= true;

if($scope.resultMap.totalPages > 5){
    if($scope.searchMap.pageNo <=3){
       lastPage = 5;
        $scope.firstDot = false;

    }else if($scope.searchMap.pageNo>=lastPage-2){
        $scope.firstDot = true;
        $scope.lastDot = false;
        firstPage = lastPage-4;

    }else {
        firstPage = $scope.searchMap.pageNo-2;
        lastPage = $scope.searchMap.pageNo+2;
    }


}else {
    $scope.firstDot = false;
    $scope.lastDot = false;

}

for(var i =firstPage;i<lastPage;i++){
    $scope.pageLable.push(i);
}


    }
//根据页码进行查询
    $scope.selectByPage = function (pageNum) {
        if(pageNum<1 || pageNum>$scope.searchMap.pageSize){
            return ;
        }else {
            $scope.searchMap.pageNo = pageNum;
            $scope.search()
        }

    }
    $scope.isTopPage = function () {
        if($scope.searchMap.pageNo==1){
            return true;
        }else {
            return false;
        }


    }
    $scope.isEndPage = function () {

        if ($scope.searchMap.pageNo == $scope.resultMap.totalPages) {
            return true;
        }else {
            return false;
        }

    }

    //排序规则
    $scope.sortSearch = function (sortField,sort) {

        $scope.searchMap.sortField = sortField;
        $scope.searchMap.sort = sort;
        $scope.search();


    }
    //判断关键字是否包含品牌
    $scope.brandIsKeywords = function () {
        for(var i = 0;i<$scope.resultMap.brandList.length;i++){
            if($scope.searchMap.keywords == $scope.resultMap.brandList[i]){
                return true
            }


        }
        return false;
    }
    //接收跳转页面的关键字

$scope.getKeywords = function () {
        $scope.searchMap.keywords = $location.search()['keywords'];
        $scope.search();


}
    
    
});




























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































